@model List<BookLibraryProject.Models.BorrowRecord>

@{
    ViewData["Title"] = "Quản lý mượn sách";
}

<h2 class="mb-4 text-center text-primary">
    📚 Quản lý Mượn/Trả Sách 📚
</h2>

<div class="card shadow-lg">
    <div class="card-body">
        <!-- Tabs điều hướng -->
        <ul class="nav nav-tabs mb-3" id="borrowTabs">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#pendingList" id="loadPendingList">
                    📌 Danh sách đăng ký mượn
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#approvedList" id="loadApprovedList">
                    ✔ Chờ lấy sách
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#borrowedList">📖 Đang mượn</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#returnedList">✅ Đã trả</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#overdueList">📅 Quá hạn</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#canceledList" id="loadRejectedList">❌ Đã hủy</a>
            </li>
        </ul>

        <!-- Nội dung của từng tab -->
        <div class="tab-content">

            <!-- Danh sách đăng ký mượn -->
            <div class="tab-pane fade show active" id="pendingList">
                <h4 class="text-primary">📌 Danh sách đăng ký mượn</h4>
                <div id="pendingListContent">
                    <p class="text-center">Đang tải danh sách...</p>
                </div>
            </div>

            <!-- Danh sách đã duyệt(Chờ lấy sách) -->
            <div class="tab-pane fade" id="approvedList">
                <h4 class="text-primary">✔ Danh sách đã duyệt</h4>
                <div id="approvedListContent">
                    <p class="text-center">Đang tải danh sách...</p>
                </div>
            </div>

            <!-- Danh sách đã duyệt(Chờ lấy sách) -->
            @* <div class="tab-pane fade" id="approvedList">
                <h4 class="text-primary">✔ Danh sách đã duyệt</h4>
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Mã cuốn sách</th>
                            <th>Người mượn</th>
                            <th>MSV</th>
                            <th>Ngày đăng ký</th>
                            <th>Hạn trả</th>
                            <th>Ngày duyệt</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>hgf785hs</td>
                            <td>Nguyen Quoc Viet</td>
                            <td>HE172106</td>
                            <td>03-10-2024</td>
                            <td>18-10-2024</td>
                            <td>04-10-2024</td>
                            <td><span class="badge bg-primary">Đã duyệt</span></td>
                            <td>
                                <button class="btn btn-info btn-sm text-white">📖 Chi tiết</button>
                                <button class="btn btn-primary btn-sm">✔ Đã lấy</button>
                                <button class="btn btn-outline-danger btn-sm">❌ Quá hạn</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div> *@

            <!-- Danh sách đang mượn -->
            <div class="tab-pane fade" id="borrowedList">
                <h4 class="text-primary">📖 Danh sách đang mượn</h4>
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Tên sách</th>
                            <th>Người mượn</th>
                            <th>Ngày mượn</th>
                            <th>Hạn trả</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>ASP.NET Core MVC</td>
                            <td>Trần Văn B</td>
                            <td>2025-03-01</td>
                            <td>2025-03-16</td>
                            <td><span class="badge bg-info">Đang mượn</span></td>
                            <td>
                                <button class="btn btn-primary btn-sm">Trả sách</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Danh sách đã trả -->
            <div class="tab-pane fade" id="returnedList">
                <h4 class="text-primary">✅ Danh sách đã trả</h4>
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Tên sách</th>
                            <th>Người mượn</th>
                            <th>Ngày mượn</th>
                            <th>Ngày trả</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Design Patterns</td>
                            <td>Nguyễn Thị C</td>
                            <td>2025-02-15</td>
                            <td>2025-03-01</td>
                            <td><span class="badge bg-success">Đã trả</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Danh sách đã hủy -->
            <div class="tab-pane fade" id="canceledList">
                <h4 class="text-primary">❌ Danh sách đã hủy</h4>
                <div id="rejectedListContent">
                    <p class="text-center">Đang tải danh sách...</p>
                </div>
            </div>

            <!-- Danh sách trễ hạn trả sách -->
            <div class="tab-pane fade" id="overdueList">
                <h4 class="text-danger">📅 Danh sách quá hạn trả sách</h4>
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Tên sách</th>
                            <th>Người mượn</th>
                            <th>Ngày mượn</th>
                            <th>Hạn trả</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Deep Learning</td>
                            <td>Nguyễn Văn C</td>
                            <td>2025-02-20</td>
                            <td class="text-danger fw-bold">2025-03-05</td>
                            <td><span class="badge bg-danger">Quá hạn</span></td>
                            <td>
                                <button class="btn btn-warning btn-sm">Nhắc nhở</button>
                                <button class="btn btn-primary btn-sm">Trả sách</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
@* <script>
    $(document).ready(function () {
        function loadPendingList() {
            $("#pendingListContent").html("<p class='text-center'>Đang tải...</p>");
            $.ajax({
                url: "/Staff/ListBorrowRequest",
                type: "GET",
                success: function (data) {
                    $("#pendingListContent").html(data); // Thay thế nội dung bằng dữ liệu từ server
                },
                error: function () {
                    $("#pendingListContent").html("<p class='text-danger'>Lỗi khi tải danh sách!</p>");
                }
            });
        }

        // Gọi Ajax khi người dùng click vào tab "Danh sách đăng ký mượn"
        $("#loadPendingList").on("click", function (e) {
            e.preventDefault();
            loadPendingList();
        });

        // Gọi Ajax ngay khi trang load lần đầu
        loadPendingList();
    });
</script>
 *@
<script>
    $(document).ready(function () {
        function loadPendingList() {
            $("#pendingListContent").html("<p class='text-center'>Đang tải...</p>");
            $.ajax({
                url: "/Staff/ListBorrowRequest",
                type: "GET",
                success: function (data) {
                    $("#pendingListContent").html(data);
                },
                error: function () {
                    $("#pendingListContent").html("<p class='text-danger'>Lỗi khi tải danh sách!</p>");
                }
            });
        }

        function loadApprovedList() {
            $("#approvedListContent").html("<p class='text-center'>Đang tải...</p>");
            $.ajax({
                url: "/Staff/ListApprovedBorrowByStaff",
                type: "GET",
                success: function (data) {
                    $("#approvedListContent").html(data);
                },
                error: function () {
                    $("#approvedListContent").html("<p class='text-danger'>Lỗi khi tải danh sách!</p>");
                }
            });
        }

        function loadRejectedList() {
            $("#rejectedListContent").html("<p class='text-center'>Đang tải...</p>");
            $.ajax({
                url: "/Staff/ListRejectedBorrowByStaff",
                type: "GET",
                success: function (data) {
                    $("#rejectedListContent").html(data);
                },
                error: function () {
                    $("#rejectedListContent").html("<p class='text-danger'>Lỗi khi tải danh sách!</p>");
                }
            });
        }

        // Gọi Ajax khi click vào từng tab
        $("#loadPendingList").on("click", function (e) {
            e.preventDefault();
            loadPendingList();
        });

        $("#loadApprovedList").on("click", function (e) {
            e.preventDefault();
            loadApprovedList();
        });

        $("#loadRejectedList").on("click", function (e) {
            e.preventDefault();
            loadRejectedList()
        });

        $(".approve-btn").click(function () {
            var id = $(this).data("id");

            $.post("/Staff/ListApprovedBorrow", { id: id }, function (response) {
                if (response.success) {
                    alert("Duyệt thành công!");
                    loadPendingList(); // Load lại danh sách đăng ký
                    loadApprovedList(); // Load lại danh sách đã duyệt
                    loadRejectedList();
                } else {
                    alert("Lỗi khi duyệt!");
                }
            });
        });

        // Gọi khi trang load lần đầu
        loadPendingList();
        loadApprovedList();
        loadRejectedList();
    });
</script>




